CREATE TABLE COMUNIDAD (
       ID_COMUNIDAD INT NOT NULL IDENTITY PRIMARY KEY
     , CALLE VARCHAR(30)
     , MAX_RECIBOS_PENDIENTES INT
     , ESTADO VARCHAR(30)
);

CREATE TABLE CONCEPTO (
       CLAVE_CONCEPTO INT NOT NULL IDENTITY PRIMARY KEY
     , DESCRIPCION VARCHAR(100)
);

CREATE TABLE PROPIETARIO (
       NIF VARCHAR(10) NOT NULL
     , NOMBRE VARCHAR(40)
     , DIRECCION VARCHAR(40)
     , POBLACION VARCHAR(40)
     , TELEFONO VARCHAR(9)
     , OBSERVACIONES VARCHAR(100)
     , FECHA_ALTA DATE
     , ENTIDAD VARCHAR(40)
     , NUMERO_CUENTA VARCHAR(10)
     , PRIMARY KEY (NIF)
);

CREATE TABLE INMUEBLE (
       ID_INMUEBLE INT NOT NULL IDENTITY PRIMARY KEY
     , ESCALERA VARCHAR(30)
     , PISO VARCHAR(30)
     , PUERTA VARCHAR(30)
     , PORCENTAJE FLOAT
     , NIF VARCHAR(10) NOT NULL
     , ID_COMUNIDAD INT NOT NULL
);

CREATE TABLE FACTURA (
       NUM_FACTURA INT NOT NULL IDENTITY PRIMARY KEY
     , FECHA_FACTURA DATE
     , ID_COMUNIDAD INT NOT NULL
);

CREATE TABLE NOTA_INFORMATIVA (
       ID_NOTA INT NOT NULL IDENTITY PRIMARY KEY
     , FECHA_CALCULO DATE
     , IMPORTE_NOTA FLOAT
     , ID_COMUNIDAD INT NOT NULL
     , NUM_FACTURA INT NOT NULL
);

CREATE TABLE LINEA_FACTURA (
       ID_LINEA INT NOT NULL IDENTITY PRIMARY KEY
     , IMPORTE_LINEA FLOAT
     , OBSERVACION VARCHAR(100)
     , CLAVE_CONCEPTO INT NOT NULL
     , NUM_FACTURA INT NOT NULL
);

CREATE TABLE RECIBO_INMUEBLE (
       ID_RECIBO INT NOT NULL IDENTITY PRIMARY KEY
     , FECHA_PAGO DATE
     , IMPORTE FLOAT
     , ID_INMUEBLE INT NOT NULL
     , ID_NOTA INT NOT NULL
);

CREATE TABLE PRESIDENTE (
       ID_COMUNIDAD INT NOT NULL
     , ID_INMUEBLE INT NOT NULL
     , PRIMARY KEY (ID_COMUNIDAD)
);

ALTER TABLE INMUEBLE
  ADD CONSTRAINT FK_INMUEBLE_1
      FOREIGN KEY (NIF)
      REFERENCES PROPIETARIO (NIF);

ALTER TABLE INMUEBLE
  ADD CONSTRAINT FK_INMUEBLE_2
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDAD (ID_COMUNIDAD);

ALTER TABLE FACTURA
  ADD CONSTRAINT FK_FACTURA_1
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDAD (ID_COMUNIDAD);

ALTER TABLE NOTA_INFORMATIVA
  ADD CONSTRAINT FK_NOTA_INFORMATIVA_1
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDAD (ID_COMUNIDAD);

ALTER TABLE NOTA_INFORMATIVA
  ADD CONSTRAINT FK_NOTA_INFORMATIVA_2
      FOREIGN KEY (NUM_FACTURA)
      REFERENCES FACTURA (NUM_FACTURA);

ALTER TABLE LINEA_FACTURA
  ADD CONSTRAINT FK_LINEA_FACTURA_1
      FOREIGN KEY (CLAVE_CONCEPTO)
      REFERENCES CONCEPTO (CLAVE_CONCEPTO);

ALTER TABLE LINEA_FACTURA
  ADD CONSTRAINT FK_LINEA_FACTURA_3
      FOREIGN KEY (ID_LINEA)
      REFERENCES LINEA_FACTURA (ID_LINEA);

ALTER TABLE LINEA_FACTURA
  ADD CONSTRAINT FK_LINEA_FACTURA_2
      FOREIGN KEY (NUM_FACTURA)
      REFERENCES FACTURA (NUM_FACTURA)
   ON DELETE CASCADE;

ALTER TABLE RECIBO_INMUEBLE
  ADD CONSTRAINT FK_RECIBO_INMUEBLE_1
      FOREIGN KEY (ID_INMUEBLE)
      REFERENCES INMUEBLE (ID_INMUEBLE);

ALTER TABLE RECIBO_INMUEBLE
  ADD CONSTRAINT FK_RECIBO_INMUEBLE_2
      FOREIGN KEY (ID_NOTA)
      REFERENCES NOTA_INFORMATIVA (ID_NOTA)
   ON DELETE CASCADE;

ALTER TABLE PRESIDENTE
  ADD CONSTRAINT FK_PRESIDENTE_1
      FOREIGN KEY (ID_COMUNIDAD)
      REFERENCES COMUNIDAD (ID_COMUNIDAD);

ALTER TABLE PRESIDENTE
  ADD CONSTRAINT FK_PRESIDENTE_2
      FOREIGN KEY (ID_INMUEBLE)
      REFERENCES INMUEBLE (ID_INMUEBLE);

